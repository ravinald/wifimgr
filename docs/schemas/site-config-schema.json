{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "wifimgr Site Configuration Schema",
  "description": "Schema for site configuration files used by wifimgr to define sites and devices",
  "type": "object",
  "required": ["version", "config"],
  "properties": {
    "version": {
      "type": "number",
      "enum": [1.0],
      "description": "The schema version"
    },
    "config": {
      "type": "object",
      "required": ["sites"],
      "description": "Configuration wrapper containing sites",
      "properties": {
        "sites": {
          "type": "object",
          "description": "Map of site configurations indexed by site name",
          "additionalProperties": {
            "type": "object",
            "required": ["site_config"],
            "properties": {
              "site_config": {
                "type": "object",
                "required": ["name"],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Site name (used in API calls)"
                  },
                  "api": {
                    "type": "string",
                    "description": "API label to use for this site (e.g., mist-prod, meraki-corp)"
                  },
                  "address": {
                    "type": "string",
                    "description": "Site physical address"
                  },
                  "country_code": {
                    "type": "string",
                    "description": "Two-letter country code"
                  },
                  "timezone": {
                    "type": "string",
                    "description": "Timezone of the site"
                  },
                  "notes": {
                    "type": "string",
                    "description": "Additional notes about the site"
                  },
                  "latlng": {
                    "type": "object",
                    "properties": {
                      "lat": { "type": "number", "description": "Latitude coordinate" },
                      "lng": { "type": "number", "description": "Longitude coordinate" }
                    },
                    "required": ["lat", "lng"]
                  }
                }
              },
              "profiles": {
                "type": "object",
                "description": "Site-level profile defaults applied to all devices",
                "properties": {
                  "wlan": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "WLAN template labels applied to all APs (device-level wlans override)"
                  },
                  "radio": {
                    "type": "string",
                    "description": "Default radio profile for all APs"
                  },
                  "device": {
                    "type": "string",
                    "description": "Default device template for all devices"
                  }
                }
              },
              "devices": {
                "type": "object",
                "description": "Devices configured for this site",
                "properties": {
                  "ap": {
                    "type": "object",
                    "description": "Access points indexed by normalized MAC address",
                    "additionalProperties": { "$ref": "#/definitions/apConfig" }
                  },
                  "switch": {
                    "type": "object",
                    "description": "Switches indexed by normalized MAC address",
                    "additionalProperties": { "$ref": "#/definitions/switchConfig" }
                  },
                  "gateway": {
                    "type": "object",
                    "description": "Gateways indexed by normalized MAC address",
                    "additionalProperties": { "$ref": "#/definitions/gatewayConfig" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "baseDeviceConfig": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string", "description": "Device name" },
        "magic": { "type": "string", "description": "Device magic/claim code" },
        "tags": { "type": "array", "items": { "type": "string" }, "description": "Tags assigned to the device" },
        "notes": { "type": "string", "description": "Additional notes about the device" },
        "mac": { "type": "string", "description": "MAC address" },
        "serial": { "type": "string", "description": "Device serial number" },
        "model": { "type": "string", "description": "Device model" },
        "id": { "type": "string", "description": "Device UUID" }
      }
    },
    "apConfig": {
      "allOf": [
        { "$ref": "#/definitions/baseDeviceConfig" },
        {
          "properties": {
            "radio_profile": { "type": "string", "description": "Reference to radio template name" },
            "device_template": { "type": "string", "description": "Reference to device template name" },
            "wlan": { "type": "array", "items": { "type": "string" }, "description": "WLAN template labels" },
            "location": {
              "type": "array",
              "description": "Location coordinates [lat, lng]",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            },
            "orientation": { "type": "number", "description": "AP orientation in degrees (0-359)" },
            "radio_config": { "$ref": "#/definitions/radioConfig" },
            "led": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean", "description": "Whether the LED is enabled" }
              }
            },
            "ip_config": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "enum": ["dhcp", "static"] },
                "ip": { "type": "string" },
                "netmask": { "type": "string" },
                "gateway": { "type": "string" },
                "vlan_id": { "type": "integer" },
                "mtu": { "type": "integer", "description": "MTU size (0 = default)" }
              }
            }
          }
        }
      ]
    },
    "switchConfig": {
      "allOf": [
        { "$ref": "#/definitions/baseDeviceConfig" },
        {
          "properties": {
            "role": { "type": "string", "enum": ["access", "aggregation", "core"] },
            "hostname": { "type": "string", "description": "Switch hostname" },
            "port_config": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "mode": { "type": "string", "enum": ["access", "trunk", "disabled"] },
                  "vlans": { "type": "array", "items": { "type": "integer" } },
                  "poe_disabled": { "type": "boolean" },
                  "description": { "type": "string" }
                }
              }
            }
          }
        }
      ]
    },
    "gatewayConfig": {
      "allOf": [
        { "$ref": "#/definitions/baseDeviceConfig" },
        {
          "properties": {
            "hostname": { "type": "string", "description": "Gateway hostname" }
          }
        }
      ]
    },
    "radioConfig": {
      "type": "object",
      "description": "Radio/RF configuration for access points",
      "properties": {
        "band_24": { "$ref": "#/definitions/radioBandConfig", "description": "2.4GHz radio settings" },
        "band_5": { "$ref": "#/definitions/radioBandConfig", "description": "5GHz radio settings" },
        "band_6": { "$ref": "#/definitions/radioBand6Config", "description": "6GHz radio settings" },
        "band_dual": { "$ref": "#/definitions/dualBandConfig", "description": "Dual-band/flex radio settings" },
        "band_24_usage": { "type": "string", "enum": ["24", "5"], "description": "Mist: dual-band radio operating mode" },
        "allow_rrm_disable": { "type": "boolean" },
        "scanning_enabled": { "type": "boolean" },
        "indoor_use": { "type": "boolean" },
        "ant_gain_24": { "type": "number" },
        "ant_gain_5": { "type": "number" },
        "ant_gain_6": { "type": "number" },
        "antenna_mode": { "type": "string" }
      }
    },
    "radioBandConfig": {
      "type": "object",
      "description": "Per-band radio settings (2.4GHz/5GHz)",
      "properties": {
        "disabled": { "type": "boolean", "description": "Whether the radio is disabled" },
        "channel": { "type": "integer", "description": "Channel number (0 = auto)", "minimum": 0 },
        "power": { "type": "integer", "description": "Transmit power in dBm", "minimum": 1, "maximum": 30 },
        "bandwidth": { "type": "integer", "description": "Channel bandwidth in MHz", "enum": [20, 40, 80, 160] },
        "channels": { "type": "array", "items": { "type": "integer" }, "description": "Allowed channel list" },
        "power_min": { "type": "integer", "description": "Minimum power (Mist only)" },
        "power_max": { "type": "integer", "description": "Maximum power (Mist only)" },
        "antenna_mode": { "type": "string" },
        "ant_gain": { "type": "number" },
        "preamble": { "type": "string", "enum": ["short", "long", "auto"] }
      }
    },
    "radioBand6Config": {
      "type": "object",
      "description": "6GHz radio settings",
      "properties": {
        "disabled": { "type": "boolean", "description": "Whether the 6GHz radio is disabled" },
        "channel": { "type": "integer", "description": "6GHz channel (1-233, step 4)", "minimum": 1, "maximum": 233 },
        "power": { "type": "integer", "description": "Transmit power in dBm", "minimum": 1, "maximum": 30 },
        "bandwidth": { "type": "integer", "description": "Channel bandwidth (up to 320 for Wi-Fi 7)", "enum": [20, 40, 80, 160, 320] }
      }
    },
    "dualBandConfig": {
      "type": "object",
      "description": "Dual-band/flex radio settings. Mist: radio_mode 24/5 (2.4GHz↔5GHz). Meraki: radio_mode 5/6 (5GHz↔6GHz).",
      "properties": {
        "disabled": { "type": "boolean", "description": "Whether the dual-band/flex radio is disabled" },
        "radio_mode": { "type": "integer", "description": "Operating band: 24, 5, or 6", "enum": [24, 5, 6] },
        "channel": { "type": "integer", "description": "Channel number (validated against radio_mode)", "minimum": 1 },
        "power": { "type": "integer", "description": "Transmit power in dBm", "minimum": 1, "maximum": 30 },
        "bandwidth": { "type": "integer", "description": "Channel bandwidth in MHz", "enum": [20, 40, 80, 160, 320] }
      }
    }
  }
}
